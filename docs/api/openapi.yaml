openapi: 3.0.0
info:
  title: DSA Learning Platform API
  description: |
    RESTful API for DSA Learning Platform
    - Authentication with JWT tokens
    - Lesson management with role-based access
    - Problem management linked to lessons
    - Test case management for problems
    - User submission tracking
  version: 1.0.0
  contact:
    name: DSA Learning Platform Team
  license:
    name: MIT

servers:
  - url: http://localhost:4000
    description: Development server
  - url: https://api.dsa-platform.com
    description: Production server (future)

paths:
  /api/health:
    get:
      tags:
        - Health
      summary: Health check endpoint
      description: Returns server status
      operationId: getHealth
      responses:
        '200':
          description: Server is running
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      ok:
                        type: boolean
                  message:
                    type: string

  /api/v1/auth/signup:
    post:
      tags:
        - Authentication
      summary: Register a new user
      description: Create a new user account
      operationId: signup
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
                - username
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  format: password
                  minLength: 6
                  example: password123
                username:
                  type: string
                  minLength: 3
                  example: john_doe
                role:
                  type: string
                  enum:
                    - STUDENT
                    - INSTRUCTOR
                    - ADMIN
                  default: STUDENT
      responses:
        '201':
          description: User registered successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      token:
                        type: string
                      user:
                        $ref: '#/components/schemas/User'
                  message:
                    type: string
        '400':
          description: Invalid input or user already exists
        '500':
          description: Server error

  /api/v1/auth/login:
    post:
      tags:
        - Authentication
      summary: Login user
      description: Authenticate user with email and password
      operationId: login
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - email
                - password
              properties:
                email:
                  type: string
                  format: email
                  example: user@example.com
                password:
                  type: string
                  format: password
                  example: password123
      responses:
        '200':
          description: Login successful
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      token:
                        type: string
                      user:
                        $ref: '#/components/schemas/User'
                  message:
                    type: string
        '401':
          description: Invalid credentials
        '500':
          description: Server error

  /api/v1/auth/me:
    get:
      tags:
        - Authentication
      summary: Get current user profile
      description: Retrieve current authenticated user information
      operationId: getCurrentUser
      security:
        - BearerAuth: []
      responses:
        '200':
          description: User profile retrieved
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/User'
                  message:
                    type: string
        '401':
          description: Unauthorized - token missing or invalid
        '500':
          description: Server error

  /api/v1/lessons:
    get:
      tags:
        - Lessons
      summary: Get all lessons
      description: Retrieve paginated list of lessons with optional filtering
      operationId: getAllLessons
      parameters:
        - name: skip
          in: query
          description: Number of records to skip
          schema:
            type: integer
            default: 0
        - name: take
          in: query
          description: Number of records to take
          schema:
            type: integer
            default: 10
        - name: category
          in: query
          description: Filter by lesson category
          schema:
            type: string
        - name: difficulty
          in: query
          description: Filter by difficulty level
          schema:
            type: string
            enum:
              - EASY
              - MEDIUM
              - HARD
      responses:
        '200':
          description: Lessons retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      lessons:
                        type: array
                        items:
                          $ref: '#/components/schemas/Lesson'
                      total:
                        type: integer
                      page:
                        type: integer
                      pageSize:
                        type: integer
                  message:
                    type: string
        '500':
          description: Server error

    post:
      tags:
        - Lessons
      summary: Create a new lesson
      description: Create a new lesson (instructor/admin only)
      operationId: createLesson
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - description
                - category
                - difficulty
                - content
              properties:
                title:
                  type: string
                  example: Arrays Fundamentals
                description:
                  type: string
                  example: Learn basics of arrays
                category:
                  type: string
                  example: Data Structures
                difficulty:
                  type: string
                  enum:
                    - EASY
                    - MEDIUM
                    - HARD
                  example: EASY
                content:
                  type: string
                  description: Markdown content
      responses:
        '201':
          description: Lesson created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/Lesson'
                  message:
                    type: string
        '400':
          description: Invalid input
        '401':
          description: Unauthorized
        '403':
          description: Forbidden - instructor access required
        '500':
          description: Server error

  /api/v1/lessons/{id}:
    get:
      tags:
        - Lessons
      summary: Get lesson by ID
      description: Retrieve a specific lesson
      operationId: getLessonById
      parameters:
        - name: id
          in: path
          required: true
          description: Lesson ID
          schema:
            type: string
      responses:
        '200':
          description: Lesson retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/Lesson'
                  message:
                    type: string
        '404':
          description: Lesson not found
        '500':
          description: Server error

    put:
      tags:
        - Lessons
      summary: Update lesson
      description: Update a lesson (author/admin only)
      operationId: updateLesson
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Lesson ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                category:
                  type: string
                difficulty:
                  type: string
                  enum:
                    - EASY
                    - MEDIUM
                    - HARD
                content:
                  type: string
      responses:
        '200':
          description: Lesson updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/Lesson'
                  message:
                    type: string
        '400':
          description: Invalid input
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Lesson not found
        '500':
          description: Server error

    delete:
      tags:
        - Lessons
      summary: Delete lesson
      description: Delete a lesson (admin only)
      operationId: deleteLesson
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Lesson ID
          schema:
            type: string
      responses:
        '200':
          description: Lesson deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '401':
          description: Unauthorized
        '403':
          description: Forbidden - admin access required
        '404':
          description: Lesson not found
        '500':
          description: Server error

  /api/v1/problems:
    get:
      tags:
        - Problems
      summary: Get all problems
      description: Retrieve paginated list of problems with optional filtering
      operationId: getAllProblems
      parameters:
        - name: skip
          in: query
          description: Number of records to skip
          schema:
            type: integer
            default: 0
        - name: take
          in: query
          description: Number of records to take
          schema:
            type: integer
            default: 10
        - name: lessonId
          in: query
          description: Filter by lesson ID
          schema:
            type: string
        - name: difficulty
          in: query
          description: Filter by difficulty level
          schema:
            type: string
            enum:
              - EASY
              - MEDIUM
              - HARD
      responses:
        '200':
          description: Problems retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    type: object
                    properties:
                      problems:
                        type: array
                        items:
                          $ref: '#/components/schemas/Problem'
                      total:
                        type: integer
                      page:
                        type: integer
                      pageSize:
                        type: integer
                  message:
                    type: string
        '500':
          description: Server error

    post:
      tags:
        - Problems
      summary: Create a new problem
      description: Create a new problem (instructor/admin only)
      operationId: createProblem
      security:
        - BearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - title
                - description
                - difficulty
                - initialCode
                - lessonId
              properties:
                title:
                  type: string
                  example: Find Maximum in Array
                description:
                  type: string
                  example: Write a function to find max element
                difficulty:
                  type: string
                  enum:
                    - EASY
                    - MEDIUM
                    - HARD
                initialCode:
                  type: string
                  description: Starter code for problem
                  example: "function findMax(arr) {\n  // Write your code here\n}"
                lessonId:
                  type: string
                  description: ID of the lesson this problem belongs to
      responses:
        '201':
          description: Problem created successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/Problem'
                  message:
                    type: string
        '400':
          description: Invalid input or missing fields
        '401':
          description: Unauthorized
        '403':
          description: Forbidden - instructor access required
        '404':
          description: Lesson not found
        '500':
          description: Server error

  /api/v1/problems/{id}:
    get:
      tags:
        - Problems
      summary: Get problem by ID
      description: Retrieve a specific problem
      operationId: getProblemById
      parameters:
        - name: id
          in: path
          required: true
          description: Problem ID
          schema:
            type: string
      responses:
        '200':
          description: Problem retrieved successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/Problem'
                  message:
                    type: string
        '404':
          description: Problem not found
        '500':
          description: Server error

    put:
      tags:
        - Problems
      summary: Update problem
      description: Update a problem (lesson author/admin only)
      operationId: updateProblem
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Problem ID
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                title:
                  type: string
                description:
                  type: string
                difficulty:
                  type: string
                  enum:
                    - EASY
                    - MEDIUM
                    - HARD
                initialCode:
                  type: string
      responses:
        '200':
          description: Problem updated successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  data:
                    $ref: '#/components/schemas/Problem'
                  message:
                    type: string
        '400':
          description: Invalid input
        '401':
          description: Unauthorized
        '403':
          description: Forbidden
        '404':
          description: Problem not found
        '500':
          description: Server error

    delete:
      tags:
        - Problems
      summary: Delete problem
      description: Delete a problem (admin only)
      operationId: deleteProblem
      security:
        - BearerAuth: []
      parameters:
        - name: id
          in: path
          required: true
          description: Problem ID
          schema:
            type: string
      responses:
        '200':
          description: Problem deleted successfully
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                  message:
                    type: string
        '401':
          description: Unauthorized
        '403':
          description: Forbidden - admin access required
        '404':
          description: Problem not found
        '500':
          description: Server error

components:
  schemas:
    User:
      type: object
      properties:
        id:
          type: string
          format: uuid
        email:
          type: string
          format: email
        username:
          type: string
        role:
          type: string
          enum:
            - STUDENT
            - INSTRUCTOR
            - ADMIN
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Lesson:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        difficulty:
          type: string
          enum:
            - EASY
            - MEDIUM
            - HARD
        category:
          type: string
        content:
          type: string
          description: Markdown content
        authorId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

    Problem:
      type: object
      properties:
        id:
          type: string
          format: uuid
        title:
          type: string
        description:
          type: string
        difficulty:
          type: string
          enum:
            - EASY
            - MEDIUM
            - HARD
        initialCode:
          type: string
        language:
          type: string
          default: javascript
        lessonId:
          type: string
          format: uuid
        createdAt:
          type: string
          format: date-time
        updatedAt:
          type: string
          format: date-time

  securitySchemes:
    BearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT
      description: JWT token obtained from /auth/login endpoint

tags:
  - name: Health
    description: Server health check
  - name: Authentication
    description: User authentication endpoints
  - name: Lessons
    description: Lesson management endpoints
  - name: Problems
    description: Problem management endpoints

x-custom-metadata:
  database-provider: Prisma
  database-type: SQLite (dev) / PostgreSQL (prod)
  authentication: JWT
  models:
    - User
    - Lesson
    - Problem
    - TestCase
    - Submission
    - UserProgress
